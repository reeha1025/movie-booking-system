{% extends "users/basic.html" %}
{% block content %}
<style>
  * { box-sizing: border-box; }
  body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; margin: 0; padding: 0; }
  .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 9999; }
  .modal-popup { background: #1f2937; border-radius: 16px; padding: 30px; max-width: 400px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); border: 1px solid #374151; }
  .modal-popup h2 { color: #10B981; margin: 0 0 15px 0; font-size: 22px; font-weight: 700; }
  .modal-popup p { color: #9ca3af; font-size: 14px; line-height: 1.6; margin: 0 0 20px 0; }
  .modal-popup .alert-box { background: rgba(255, 193, 7, 0.1); border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin-bottom: 20px; color: #f59e0b; font-size: 13px; }
  .modal-popup .btn-continue { background: linear-gradient(135deg, #10B981 0%, #059669 100%); border: none; border-radius: 8px; color: #fff; padding: 12px 30px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s; }
  .modal-popup .btn-continue:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(16, 185, 129, 0.4); }
  .otp-container { max-width: 450px; margin: 20px auto; padding: 15px; width: 100%; }
  .card { background: #1f2937; border: 1px solid #374151; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); overflow: hidden; }
  .card-header { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 16px 16px 0 0; padding: 20px; text-align: center; }
  .card-header h3 { color: #fff; margin: 0; font-weight: 700; font-size: clamp(20px, 5vw, 28px); }
  .card-body { padding: clamp(15px, 4vw, 32px); text-align: center; }
  .upi-logo { width: clamp(60px, 20vw, 80px); height: clamp(60px, 20vw, 80px); margin: 0 auto 20px; background: #fff; border-radius: 16px; padding: 12px; }
  .upi-logo img { width: 100%; height: 100%; object-fit: contain; }
  .info-text { color: #9ca3af; font-size: clamp(12px, 3vw, 14px); margin-bottom: 24px; line-height: 1.6; }
  .email-display { background: #111827; border-radius: 8px; padding: 12px; margin-bottom: 24px; word-break: break-all; }
  .email-label { color: #9ca3af; font-size: clamp(10px, 2.5vw, 12px); }
  .email-value { color: #FF0000; font-weight: 600; font-size: clamp(12px, 3vw, 14px); }
  .otp-input-group { display: flex; justify-content: center; gap: clamp(8px, 2vw, 12px); margin-bottom: 24px; flex-wrap: wrap; }
  .otp-input { width: clamp(45px, 15vw, 50px); height: clamp(50px, 15vw, 60px); text-align: center; font-size: clamp(20px, 5vw, 24px); font-weight: 700; background: #111827; border: 2px solid #374151; border-radius: 12px; color: #f3f4f6; outline: none; transition: all 0.3s; touch-action: manipulation; }
  .otp-input:focus { border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
  .btn-verify { width: 100%; padding: 16px; background: linear-gradient(135deg, #FF0000 0%, #FF0000 100%); border: none; border-radius: 12px; color: #fff; font-size: clamp(16px, 4vw, 18px); font-weight: 700; cursor: pointer; transition: all 0.3s; min-height: 50px; touch-action: manipulation; }
  .btn-verify:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3); }
  .resend-link { color: #6366f1; text-decoration: none; font-size: clamp(12px, 3vw, 14px); margin-top: 16px; display: inline-block; }
  .resend-link:hover { text-decoration: underline; }
  .timer { color: #f59e0b; font-size: clamp(12px, 3vw, 14px); margin-top: 16px; }
  .success-message { background: rgba(16, 185, 129, 0.1); border: 1px solid #FF0000; border-radius: 8px; padding: 12px; margin-bottom: 20px; color: #FF0000; font-size: clamp(12px, 3vw, 14px); }
  @media (max-width: 480px) {
    .otp-container { margin: 10px auto; padding: 10px; }
    .card-body { padding: 15px; }
  }
</style>

<div id="dummyModal" class="modal-overlay">
  <div class="modal-popup">
    <h2>⚠️ Important Notice</h2>
    <div class="alert-box">
      This is a <strong>DEMO/DUMMY website</strong>
    </div>
    <p>
      This is a demonstration booking system. <strong>No real OTP will be sent</strong> to your email.
    </p>
    <p>
      You can enter <strong>any 4-digit code</strong> (like 1234, 5678, etc.) to verify and proceed to the next page.
    </p>
    <p style="color: #10B981; font-weight: 600;">
      Click "Continue" to start the demo payment flow.
    </p>
    <button class="btn-continue" onclick="closeModal()">Continue to OTP Verification</button>
  </div>
</div>

<div class="otp-container">
  <div class="card">
    <div class="card-header">
      <h3>Verify OTP</h3>
    </div>
    <div class="card-body">
      <div class="upi-logo">
        {% if upi_app == 'gpay' %}
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style="width: 60px; height: 60px;">
          <circle cx="32" cy="32" r="32" fill="#4285F4"/>
          <text x="32" y="36" text-anchor="middle" font-size="28" font-weight="bold" fill="white">G</text>
        </svg>
        {% elif upi_app == 'phonepe' %}
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style="width: 60px; height: 60px;">
          <rect width="64" height="64" fill="#5F4B8B"/>
          <text x="32" y="36" text-anchor="middle" font-size="22" font-weight="bold" fill="white">PP</text>
        </svg>
        {% elif upi_app == 'paytm' %}
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style="width: 60px; height: 60px;">
          <rect width="64" height="64" fill="#002970"/>
          <text x="32" y="36" text-anchor="middle" font-size="20" font-weight="bold" fill="white">Paytm</text>
        </svg>
        {% else %}
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style="width: 60px; height: 60px;">
          <circle cx="32" cy="32" r="32" fill="#1F4A94"/>
          <text x="32" y="36" text-anchor="middle" font-size="16" font-weight="bold" fill="white">BHIM</text>
        </svg>
        {% endif %}
      </div>

      <div class="success-message">
        OTP sent successfully to your registered email!
      </div>

      <div class="info-text">
        We've sent a 4-digit verification code to your registered email address. Please enter the code below to continue.
      </div>

      <div class="email-display">
        <div class="email-label">OTP sent to</div>
        <div class="email-value">{{ user_email }}</div>
      </div>

      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="upi_app" value="{{ upi_app }}">
        
        <div class="otp-input-group">
          <input type="text" class="otp-input" maxlength="1" name="otp1" id="otp1" autofocus>
          <input type="text" class="otp-input" maxlength="1" name="otp2" id="otp2">
          <input type="text" class="otp-input" maxlength="1" name="otp3" id="otp3">
          <input type="text" class="otp-input" maxlength="1" name="otp4" id="otp4">
        </div>

        <button type="submit" class="btn-verify">Verify & Continue</button>
      </form>

      <div class="timer" id="timer">Resend OTP in <span id="countdown">30</span>s</div>
      <a href="#" class="resend-link" id="resendLink" style="display:none;" onclick="resendOTP()">Resend OTP</a>
    </div>
  </div>
</div>

<script>
function closeModal() {
  document.getElementById('dummyModal').style.display = 'none';
}

const inputs = document.querySelectorAll('.otp-input');
inputs.forEach((input, index) => {
  input.addEventListener('input', (e) => {
    if (e.target.value.length === 1 && index < inputs.length - 1) {
      inputs[index + 1].focus();
    }
  });
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Backspace' && !e.target.value && index > 0) {
      inputs[index - 1].focus();
    }
  });
});

let countdown = 30;
const timer = setInterval(() => {
  countdown--;
  document.getElementById('countdown').textContent = countdown;
  if (countdown <= 0) {
    clearInterval(timer);
    document.getElementById('timer').style.display = 'none';
    document.getElementById('resendLink').style.display = 'inline-block';
  }
}, 1000);

function resendOTP() {
  alert('OTP resent to your email!');
  location.reload();
}
</script>
{% endblock %}
