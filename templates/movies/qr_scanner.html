{% extends "users/basic.html" %}
{% block content %}
<style>
  * { box-sizing: border-box; }
  body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; margin: 0; padding: 0; }
  .scanner-container { max-width: 500px; margin: 20px auto; padding: 15px; width: 100%; }
  .card { background: #1f2937; border: 1px solid #374151; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); overflow: hidden; }
  .card-header { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); padding: 20px; text-align: center; }
  .card-header h3 { color: #fff; margin: 0; font-weight: 700; font-size: clamp(20px, 5vw, 28px); }
  .card-body { padding: clamp(15px, 4vw, 32px); text-align: center; }
  .qr-section { background: #fff; border-radius: 16px; padding: 15px; margin-bottom: 24px; }
  .qr-code { width: clamp(140px, 50vw, 200px); height: clamp(140px, 50vw, 200px); margin: 0 auto 16px; position: relative; }
  .qr-code img { width: 100%; height: 100%; }
  .scan-line { position: absolute; width: 100%; height: 3px; background: linear-gradient(90deg, transparent, #dc3545, transparent); top: 0; left: 0; animation: scan 2s linear infinite; }
  @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
  .qr-hint { color: #6b7280; font-size: clamp(12px, 3vw, 14px); }
  .upi-id-section { background: #111827; border-radius: 12px; padding: 16px; margin-bottom: 24px; word-break: break-all; }
  .upi-id-label { color: #9ca3af; font-size: clamp(10px, 2.5vw, 12px); margin-bottom: 4px; }
  .upi-id-value { color: #dc3545; font-size: clamp(14px, 4vw, 18px); font-weight: 600; font-family: monospace; }
  .copy-btn { background: #374151; border: none; color: #f3f4f6; padding: 10px 16px; border-radius: 8px; cursor: pointer; margin-top: 8px; font-size: clamp(11px, 3vw, 12px); touch-action: manipulation; min-height: 40px; }
  .copy-btn:hover { background: #4b5563; }
  .amount-badge { background: linear-gradient(135deg, #dc3545 0%, #bb2d3b 100%); color: #fff; padding: 12px 24px; border-radius: 50px; font-size: clamp(20px, 5vw, 24px); font-weight: 700; display: inline-block; margin-bottom: 24px; }
  .timer-section { margin-bottom: 24px; }
  .timer-label { color: #9ca3af; font-size: clamp(12px, 3vw, 14px); margin-bottom: 8px; }
  .timer-value { color: #f59e0b; font-size: clamp(28px, 7vw, 32px); font-weight: 700; font-family: monospace; }
  .btn-paid { width: 100%; padding: 16px; background: linear-gradient(135deg, #dc3545 0%, #bb2d3b 100%); border: none; border-radius: 12px; color: #fff; font-size: clamp(16px, 4vw, 18px); font-weight: 700; cursor: pointer; transition: all 0.3s; margin-bottom: 12px; min-height: 50px; touch-action: manipulation; }
  .btn-paid:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3); }
  .btn-cancel { width: 100%; padding: 12px; background: transparent; border: 2px solid #ef4444; border-radius: 12px; color: #ef4444; font-size: clamp(14px, 4vw, 16px); font-weight: 600; cursor: pointer; transition: all 0.3s; min-height: 45px; touch-action: manipulation; }
  .btn-cancel:hover { background: rgba(239, 68, 68, 0.1); }
  .warning-text { background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; color: #f59e0b; font-size: clamp(11px, 3vw, 12px); margin-top: 20px; }
  .steps { text-align: left; background: #111827; border-radius: 12px; padding: 16px; margin-bottom: 24px; }
  .step { display: flex; align-items: flex-start; margin-bottom: 12px; color: #9ca3af; font-size: clamp(12px, 3vw, 14px); gap: 8px; }
  .step:last-child { margin-bottom: 0; }
  .step-number { background: #6366f1; color: #fff; width: 24px; height: 24px; min-width: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; flex-shrink: 0; }
  @media (max-width: 480px) {
    .scanner-container { margin: 10px auto; padding: 10px; }
    .card-body { padding: 15px; }
  }
</style>

<div class="scanner-container">
  <div class="card">
    <div class="card-header">
      <h3>Scan & Pay</h3>
    </div>
    <div class="card-body">
      <div class="amount-badge">₹{{ amount }}</div>

      <div class="qr-section">
        <div class="qr-code">
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=bookmyseat@upi%26pn=BookMySeat%26am={{ amount }}%26cu=INR" alt="QR Code">
          <div class="scan-line"></div>
        </div>
        <div class="qr-hint">Scan this QR code using any UPI app</div>
      </div>

      <div class="upi-id-section">
        <div class="upi-id-label">Or pay using UPI ID</div>
        <div class="upi-id-value">bookmyseat@upi</div>
        <button class="copy-btn" onclick="copyUPI()">Copy UPI ID</button>
      </div>

      <div class="timer-section">
        <div class="timer-label">Time remaining</div>
        <div class="timer-value" id="timer">04:59</div>
      </div>

      <div class="steps">
        <div class="step">
          <span class="step-number">1</span>
          <span>Open any UPI app (GPay, PhonePe, Paytm, etc.)</span>
        </div>
        <div class="step">
          <span class="step-number">2</span>
          <span>Scan the QR code or enter the UPI ID</span>
        </div>
        <div class="step">
          <span class="step-number">3</span>
          <span>Enter the exact amount: ₹{{ amount }}</span>
        </div>
        <div class="step">
          <span class="step-number">4</span>
          <span>Complete payment & click "I've Paid" below</span>
        </div>
      </div>

      <form method="post">
        {% csrf_token %}
        <button type="submit" class="btn-paid">I've Completed Payment</button>
      </form>
      
      <a href="{% url 'cancel_booking' booking.id %}" class="btn-cancel" style="display: block; text-decoration: none; text-align: center;">Cancel Payment</a>

      <div class="warning-text">
        This is a demo payment page. No real transaction will occur. Click "I've Completed Payment" to simulate a successful payment.
      </div>
    </div>
  </div>
</div>

<script>
function copyUPI() {
  navigator.clipboard.writeText('bookmyseat@upi');
  alert('UPI ID copied to clipboard!');
}

let time = 299;
const timerEl = document.getElementById('timer');
const countdown = setInterval(() => {
  time--;
  const mins = Math.floor(time / 60);
  const secs = time % 60;
  timerEl.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
  if (time <= 0) {
    clearInterval(countdown);
    alert('Payment timeout! Please try again.');
    window.location.href = '/';
  }
}, 1000);
</script>
{% endblock %}
